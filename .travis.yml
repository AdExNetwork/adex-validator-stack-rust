language: rust
rust:
  - stable
# Need to cache the whole `.cargo` directory to keep .crates.toml for
# cargo-update to work
cache:
  directories:
    - /home/travis/.cargo
# But don't cache the cargo registry
before_cache:
  - rm -rf /home/travis/.cargo/registry
env:
  global:
    - CARGO_MAKE_RUN_CHECK_FORMAT="true"
    - CARGO_MAKE_RUN_CLIPPY="true"
services:
  - redis-server
matrix:
  fast_finish: true
script:
  - which cargo-make || cargo install cargo-make
  - cargo make ci-flow